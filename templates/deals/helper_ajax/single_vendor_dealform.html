<form method="post" action="{% url 'single_vendor_dealform'%}">
{% csrf_token %}
<div class="row">
            <div class="col-4 form-group ">
                <label for="date" class="col-form-label">Date</label>
                <span class="asterixField">*</span>
                <input type="date" class="form-control form-control-sm" name="date" id="date" value="{{ today }}" required>
                <small id="date" class="form-text text-muted"> Date On Which Deal is Received</small>

            </div>
            <div class="col-4 form-group">
                <label for="vendor" class="col-form-label">Vendor</label>
                <select class="form-control form-control-sm" id="vendor" name = 'vendor'>
                    {% for vendor in vendors %}
                    <option value="{{ vendor.pk }}">{{ vendor.contact_name}}</option>
                    {% endfor %}
                </select>
                <small id="vendor" class="form-text text-muted"> Select Vendor</small>
            </div>

            <div class="col-4 form-group">
                <label for="delivery_terms" class="col-form-label">Delivery Terms</label>
                <select class="form-control form-control-sm" id="delivery_terms" name='delivery_terms'>
                    <option value="Door Deliver">Door Deliver</option>
                    <option value="Ex-Godown">Ex-Godown</option>
                    <option value="FOR">FOR</option>
                    <option value="Local Transport">Local Transport</option>
                </select>
                <small id="delivery_terms" class="form-text text-muted"> Select Delivery Terms</small>
            </div>


            <div class="col-12 form-group">
                <select class="js-example-basic-single " id='mySelect2' style="width:100%" name="products[]" multiple="multiple" required>
            {% for group in product_groups %}
                    <optgroup label="{{ group.name }}">
                        {% for product in group.product_set.all %}
                        <option value="{{ product.pk }}" data-group="{{ group.name }}" data-groupid="{{ group.id }}" data-unit="{{ product.unit }}" data-make="{{ product.make }}">{{ product.name }}</option>
                        {% endfor %}
                    </optgroup>
                    {% endfor %}  
                    <optgroup label="Ungrouped Products">
                    {% for product in products %}
                        {% if product.group %}
                        {% else %}
                        <option value="{{ product.pk }}" data-group="{{ product.group }}" data-groupid="{{ product.group.id }}" data-make="{{ product.make }}" data-unit="{{ product.unit }}">{{ product.name }}</option>
                        {% endif %}
                    {% endfor %} 
            </select>
            <small id="products-multiselect" class="form-text text-muted"> Select Products</small>
            </div>
        </div>
        
        <table class="table table-hover table-responsive" style="max-height:200px" id="selectedProductsTable">
  <thead>
    <tr>
      <th scope="col">Group</th>
      <th scope="col">Product Name</th>
      <th scope="col">Label Name</th>
      <th scope="col">Make</th>
      <th scope="col">Specs</th>
      <th scope="col">Quantity</th>
      <th scope="col">Unit</th>
      <th scope="col">Price</th>
      <th scope="col">Lead Time</th>
      <th scope="col">Expiry Date</th>
    
    </tr>
  </thead>
  <tbody>
    
  </tbody>
</table>
<div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
        <button type="submit"  class="btn btn-outline-success">Add Deal</button>
      </div>
</form>

<script>
$(document).ready(function() {
    $('.js-example-basic-single').select2({
        placeholder: 'Select Products',
        width:'resolve',
        minimumResultsForSearch: 1000,
        


    });
    $('#mySelect2').on('select2:select', function (e) {
        
    var data = e.params.data;
    var group = $(e.params.data.element).data('group');
    var group_id = $(e.params.data.element).data('groupid');
    var make = $(e.params.data.element).data('make');
    var unit = $(e.params.data.element).data('unit');
    console.log(make);
    $('#selectedProductsTable tbody').prepend('<tr id ="'+data.id+'"><td><input name="product_group" type="hidden" value="'+group_id+'">'+group+'</td><td>'+data.text+'</td><td> <input name="label_name" placeholder="Label Name" type="text" class="form-control form-control-sm"></td><td>'+make+'<input name="make" class="form-control form-control-sm" value="'+make+'" type="hidden"></td><td> <input name="spec" placeholder="Specifications" type="text" class="form-control form-control-sm"></td><td><input name="quantity" step="0.01" type="number" class="form-control form-control-sm" ></td><td>'+unit+'<input class="form-control form-control-sm" name="unit" type="hidden" value="'+unit+'"></tdtd></td><td><input name="price" type="number" step="0.01" value="0" class="form-control form-control-sm" required></td><td><input name="lead_time" type="number" class="form-control form-control-sm"></td><td><input name="price_valid_till" type="date" class="form-control form-control-sm" required></td></tr>');
    console.log(String(make));
    console.log(String(unit));
    });
    $('#mySelect2').on('select2:unselect', function (e) {
        var data = e.params.data;
        //$('#selectedProductsTable tbody').prepend('<tr><td>'+data.id+'</td><td>'+data.text+'</td></tr>');
        $('#selectedProductsTable tbody #'+data.id).remove();
        console.log(data);
    });
    
});
</script>